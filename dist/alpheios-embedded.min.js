window.AlpheiosEmbed=function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e){e.exports={name:"alpheios-embedded",version:"1.0.0",build:"25",description:"Alpheios Embedded Library",main:"dist/alpheios-embedded.js",directories:{doc:"doc"},scripts:{test:"eslint --fix src/**/*.js && jest --coverage && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",build:"eslint --fix src/**/*.js && node --experimental-modules ./node_modules/alpheios-node-build/dist/build.mjs all all app config.mjs && npm run update-dependencies","build-prod":"eslint --fix src/**/*.js && node --experimental-modules ./node_modules/alpheios-node-build/dist/build.mjs all production app config.mjs && npm run update-dependencies","build-dev":"eslint --fix src/**/*.js && node --experimental-modules ./node_modules/alpheios-node-build/dist/build.mjs all development app config.mjs && npm run update-dependencies","auth0-env-update":"node --experimental-modules ./node_modules/alpheios-node-build/dist/files.mjs replace --s=../protected-config/auth0/prod --t=dist/auth0 --f=env-embed.js","auth0-env-dev-update":"node --experimental-modules ./node_modules/alpheios-node-build/dist/files.mjs replace --s=../protected-config/auth0/dev --t=dist/auth0 --f=env-embed.js",lint:"eslint --fix src/**/*.js","update-dependencies":"node --experimental-modules ./node_modules/alpheios-node-build/dist/files.mjs replace --s=./node_modules/alpheios-components/dist/ --t=dist/lib --f=alpheios-components.js --f=alpheios-components.js.map --f=alpheios-components.min.js && node --experimental-modules ./node_modules/alpheios-node-build/dist/files.mjs replace --s=./node_modules/alpheios-components/dist/style --t=dist/style --f=style-components.css --f=style-components.css.map --f=style-components.min.css  --f=style-components-safari.css --f=style-components-safari.css.map --f=style-components-safari.min.css","build-prod-experimental":"node --experimental-modules ./node_modules/alpheios-node-build/dist/build.mjs webpack production app config.mjs && npm run update-dependencies","build-dev-experimental":"node --experimental-modules ./node_modules/alpheios-node-build/dist/build.mjs webpack development app config.mjs && npm run update-dependencies",dev:"npm run build-dev-experimental && http-server -c-1 -p 8888 & onchange src -- npm run build-dev-experimental"},repository:{type:"git",url:"git+https://github.com/alpheios-project/wordsvc.git"},author:"The Alpheios Project, Ltd.",license:"ISC",bugs:{url:"https://github.com/alpheios-project/wordsvc/issues"},homepage:"https://github.com/alpheios-project/wordsvc#readme",devDependencies:{"alpheios-client-adapters":"github:alpheios-project/client-adapters","alpheios-components":"file:../components","alpheios-data-models":"github:alpheios-project/data-models","alpheios-experience":"github:alpheios-project/experience","alpheios-inflection-tables":"git://github.com/alpheios-project/inflection-tables.git","alpheios-node-build":"github:alpheios-project/node-build#code-analysis","alpheios-res-client":"github:alpheios-project/res-client","alpheios-wordlist":"github:alpheios-project/wordlist",coveralls:"^3.0.4","css-loader":"^3.0.0",eslint:"^6.0.1","eslint-config-standard":"^12.0.0","eslint-plugin-import":"^2.18.0","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.0","eslint-plugin-vue":"^5.2.3","html-loader":"^0.5.5","html-loader-jest":"^0.2.1","http-server":"^0.11.1",interactjs:"^1.4.11","intl-messageformat":"^2.2.0",jest:"^24.8.0","jest-fetch-mock":"^2.1.2",onchange:"^6.0.0","raw-loader":"^3.0.0","sass-loader":"^7.1.0","source-map-loader":"^0.2.4","style-loader":"^0.23.1","url-loader":"^2.0.1","vue-loader":"^15.7.0","vue-style-loader":"^4.1.2","vue-svg-loader":"^0.12.0","webpack-dev-server":"^3.7.2"},engines:{node:">= 9.10.1",npm:">= 5.6.0"},jest:{verbose:!0,transform:{"^.+\\.htmlf$":"html-loader-jest","^.+\\.jsx?$":"babel-jest"},transformIgnorePatterns:["node_modules/alpheios-components/"]},eslintConfig:{env:{browser:!0,node:!0},parser:"babel-eslint",parserOptions:{sourceType:"module",ecmaVersion:2019,allowImportExportEverywhere:!0}},standard:{ignore:["**/dist","**/support"]},dependencies:{}}},function(e,t,s){"use strict";s.r(t);class State{constructor(e){this.panelStatus=void 0,this.tab=void 0,this.watchers=new Map}static create(e){let t=new State;for(let s of Object.keys(e))t[s]=e[s];return t}static get defaults(){return{panelStatus:State.statuses.panel.OPEN}}static get statuses(){return{embedLib:{PENDING:Symbol.for("Alpheios_Status_Pending"),ACTIVE:Symbol.for("Alpheios_Status_Active"),DEACTIVATED:Symbol.for("Alpheios_Status_Deactivated"),DISABLED:Symbol.for("Alpheios_Status_Disabled")},panel:{OPEN:Symbol.for("Alpheios_Status_PanelOpen"),CLOSED:Symbol.for("Alpheios_Status_PanelClosed"),DEFAULT:Symbol.for("Alpheios_Status_PanelDefault")},tab:{DEFAULT:"default"}}}setWatcher(e,t){return this.watchers.set(e,t),this}setItem(e,t){return this[e]=t,this.watchers&&this.watchers.has(e)&&this.watchers.get(e)(e,this),this}isPanelOpen(){return this.panelStatus===State.statuses.panel.OPEN}isPanelClosed(){return this.panelStatus===State.statuses.panel.CLOSED}isPanelStateDefault(){return this.panelStatus===State.statuses.panel.DEFAULT}isPanelStateValid(){return this.panelStatus===State.statuses.panel.OPEN||this.panelStatus===State.statuses.panel.CLOSED}setPanelOpen(){return this.setItem("panelStatus",State.statuses.panel.OPEN),this}setPanelClosed(){return this.setItem("panelStatus",State.statuses.panel.CLOSED),this}changeTab(e){return this.setItem("tab",e),this}activateUI(){return this.setItem("uiActive",!0),this}isActive(){return this.status===State.statuses.embedLib.ACTIVE}isDeactivated(){return this.status===State.statuses.embedLib.DEACTIVATED}isDisabled(){return this.status===State.statuses.embedLib.DISABLED}isTabStateDefault(){return this.tab===State.statuses.tab.DEFAULT}uiIsActive(){return this.uiActive}activate(){return this.status=State.statuses.embedLib.ACTIVE,this}deactivate(){return this.status=State.statuses.embedLib.DEACTIVATED,this}disable(){return this.status=State.statuses.embedLib.DISABLED,this}}var o=s(0);class AppAuthenticator{constructor(){this.auth0Lock=null,this._auth0profile=null}loginUrl(){return null}logoutUrl(){return null}session(){return new Promise((e,t)=>{t(new Error("Session request not supported"))})}authenticate(){return new Promise((e,t)=>{if(!this.auth0Lock){if(!auth0Env){let e="Unable to find Auth0 configuration. Auth0 functionality will be disabled";console.error(e),t(e)}this.auth0env=auth0Env,this.auth0env.TEST_ID?(localStorage.setItem("access_token",this.auth0env.TEST_ID),localStorage.setItem("id_token",this.auth0env.TEST_ID),localStorage.setItem("is_test_user",!0),e("Authenticated")):(this.auth0Lock=new Auth0Lock(this.auth0env.CLIENT_ID,this.auth0env.DOMAIN,{theme:{logo:"https://alpheios.net/logos/alpheios_32.png",labeledSubmitButton:!1,primaryColor:"#436476"},languageDictionary:{title:"Login",signUpTerms:'By signing up, you agree to our <a href="https://alpheios.net/pages/userterms" target="_blank">terms of service</a> and <a href="https://alpheios.net/pages/privacy-policy">privacy policy</a>.'},mustAcceptTerms:!0,auth:{redirect:!1,params:{audience:this.auth0env.AUDIENCE,scope:"openid profile email",prompt:"consent select_account"},responseType:"token id_token"}}),this.auth0Lock.on("authenticated",t=>{this.auth0Lock.hide(),localStorage.setItem("access_token",t.accessToken),localStorage.setItem("id_token",t.idToken),e("Authenticated")}),this.auth0Lock.on("unrecoverable_error",e=>{console.error("Auth0 Lock unrecoverable error: ",e),t("Auth0 Lock unrecoverable")}),this.auth0Lock.on("authorization_error",e=>{console.error("Auth0 Lock authorization error: ",e),t("Auth0Lock authorization error")}),this.auth0Lock.show())}})}getProfileData(){return new Promise((e,t)=>{const s=localStorage.getItem("access_token");if(s||(console.error("You must login to call this protected endpoint!"),t("Login required")),localStorage.getItem("is_test_user")){let t={name:"Alpheios Test User",nickname:"testuser",sub:"testuser"};localStorage.setItem("profile",JSON.stringify(t)),e(t)}else this.auth0Lock.getUserInfo(s,(s,o)=>{s?t(s):(localStorage.setItem("profile",JSON.stringify(o)),e(o))})})}getUserData(){return new Promise((e,t)=>{const s=localStorage.getItem("access_token");s||(console.error("You must login to call this protected endpoint!"),t("Not Authenticated")),e(s)})}getEndPoints(){return this.auth0env.ENDPOINTS}logout(){localStorage.removeItem("id_token"),localStorage.removeItem("access_token"),localStorage.removeItem("profile"),this.auth0Lock.logout({returnTo:this.auth0env.LOGOUT_URL})}}class SessionAuthenticator{constructor(e){this.sessionUrl=serverEnv.SESSION_URL,this.tokenUrl=serverEnv.TOKEN_URL,this.endpoints=serverEnv.ENDPOINTS,this._loginUrl=serverEnv.LOGIN_URL,this._logoutUrl=serverEnv.LOGOUT_URL}loginUrl(){return this._loginUrl}logoutUrl(){return this._logoutUrl}session(){return new Promise((e,t)=>{window.fetch(this.sessionUrl).then(s=>{s.ok?e(s.json()):t(s.code)}).catch(e=>{t(`Session request failed ${e}`)})})}authenticate(){return new Promise((e,t)=>{t("Server Side Authenticator")})}getUserData(){return new Promise((e,t)=>{window.fetch(this.tokenUrl).then(s=>{s.ok?e(s.json()):t(s.code)}).catch(e=>{t(`token request failed ${e}`)})})}getEndPoints(){return this.endpoints}logout(){console.error("Logout called from Server Side Authenticator")}}let i;function n(e){let t={};switch(e.mode){case"development":t.components="./lib/alpheios-components.min.js";break;case"custom":t=e.libs;break;default:t.components="./lib/alpheios-components.js"}return new Promise((e,s)=>{let o=[],n=import(t.components).then(()=>{console.info("Components library has been imported successfully"),i=window.AlpheiosComponents});o.push(n),Promise.all(o).then(()=>{console.info("All promises have been imported successfully"),e(embedded_Embedded)}).catch(e=>{s(e)})})}s.d(t,"importDependencies",function(){return n});class embedded_Embedded{constructor({clientId:e=null,documentObject:t=document,mobileRedirectUrl:s=null,enabledSelector:n=".alpheios-enabled",disabledSelector:r="",enabledClass:l="",disabledClass:a="",triggerEvents:d="dblclick",triggerPreCallback:u=(e=>!0),popupInitialPos:c={},toolbarInitialPos:h={},layoutType:p="default",disableTextSelection:m=!1}={}){if(this.clientId=e,null===this.clientId)throw new Error("Please identify the site.");let b;this.doc=t,this.state=new State,this.mobileRedirectUrl=s,this.enabledSelector=n,this.disabledSelector=r,this.enabledClass=l,this.disabledClass=a,this.triggerEvents=d,this.triggerPreCallback=u;try{b=o}catch(e){throw new Error("Cannot parse package.json, its format is probably incorrect")}this.state.setPanelClosed(),this.state.tab="info",this.ui=i.UIController.create(this.state,{storageAdapter:i.LocalStorageArea,textQueryTrigger:this.triggerEvents,textQuerySelector:this.enabledSelector,app:{version:`${b.version}.${b.build}`,name:b.description},disableTextSelection:m}),"undefined"!=typeof auth0Env?this.ui.registerModule(i.AuthModule,{auth:new AppAuthenticator}):"undefined"!=typeof serverEnv?this.ui.registerModule(i.AuthModule,{auth:new SessionAuthenticator(serverEnv.sessionUrl)}):this.ui.registerModule(i.AuthModule,{auth:null}),this.ui.registerModule(i.PanelModule,{});let g={};if(c&&Object.values(c).filter(e=>Boolean(e)).length>0&&(g.initialPos=c),this.ui.registerModule(i.PopupModule,g),"default"===p){let e={};h&&Object.values(h).filter(e=>Boolean(e)).length>0&&(e.initialPos=h),this.ui.registerModule(i.ToolbarModule,e),this.ui.registerModule(i.ActionPanelModule)}else if("readingTools"===p)if(this.ui.platform.isDesktop){let e={};h&&Object.values(h).filter(e=>Boolean(e)).length>0&&(e.initialPos=h),this.ui.registerModule(i.ToolbarModule,e)}else this.ui.platform.isMobile&&this.ui.registerModule(i.ActionPanelModule,{lookupResultsIn:"panel"})}notifyExtension(){this.doc.body.dispatchEvent(new Event("Alpheios_Embedded_Response"))}async activate(){try{this.notifyExtension(),await this.ui.activate(),this.doc.body.setAttribute("alpheios-embed-lib-status","active"),this.doc.body.addEventListener("Alpheios_Embedded_Check",e=>{this.notifyExtension(e)})}catch(e){return void console.error(`Cannot activate a UI controller: ${e}`)}this.mobileRedirectUrl&&this.detectMobile()&&(document.location=this.mobileRedirectUrl);let e=this.enabledSelector,t=this.triggerEvents.split(/,/);if(!e||!t)throw new Error("Configuration must define both trigger and selector");let s=this.doc.querySelectorAll(e);if(0===s.length&&console.log(`No elements matching ${s}`),this.enabledClass)for(let e of s)e.classList.add(this.enabledClass);if(this.disabledSelector){let e=this.doc.querySelectorAll(this.disabledSelector);for(let t of e)t.setAttribute("data-alpheios-ignore","all"),this.disabledClass&&t.classList.add(this.disabledClass)}new i.AlignmentSelector(this.doc,{}).activate();i.UIController.initAlignedTranslation(this.doc,".aligned-translation",{edges:{left:!0,right:!0,bottom:!1,top:!1},restrictSize:{min:{width:200}},restrictEdges:{outer:this.doc.body,endOnly:!0},inertia:!0},e=>{e.target.style.width=`${e.rect.width}px`})}get platform(){return this.ui.platform}openToolbar(){this.ui.openToolbar()}openActionPanel(){this.ui.openActionPanel()}detectMobile(){if(window.sessionStorage.desktop)return!1;if(window.localStorage.mobile)return!0;var e=["iphone","ipad","android","blackberry","nokia","opera mini","windows mobile","windows phone","iemobile"];for(var t in e)if(navigator.userAgent.toLowerCase().indexOf(e[t].toLowerCase())>0)return!0;return!1}}}]);